#!/bin/bash
[ $# -ne 1 ]&&exit 1;d="$1";o="$d.csv";whois "$d"|awk -v OFS="," 'BEGIN{sec="";order[1]="Name";order[2]="Organization";order[3]="Street";order[4]="City";order[5]="State/Province";order[6]="Postal Code";order[7]="Country";order[8]="Phone";order[9]="Phone Ext:";order[10]="Fax";order[11]="Fax Ext:";order[12]="Email"}function reset(){for(i in order)f[order[i]]=""}function dump(p, i){for(i=1;i<=12;i++){v=f[order[i]];if(order[i]=="Street")v=v" ";printf "%s %s%s%s",p,order[i],OFS,v;if(!(p=="Tech"&&i==12))printf "\n"}}/^Registrant:/{if(sec!=""){dump(sec)}sec="Registrant";reset();next}/^Admin:/{dump(sec);sec="Admin";reset();next}/^Tech:/{dump(sec);sec="Tech";reset();next}sec!=""&&/^[ \t]*[^:]+:/{k=$0;sub(/^[ \t]*/,"",k);split(k,a,":");key=a[1];sub(/^[^:]+:[ \t]*/,"",$0);if(key in f)f[key]=$0}END{if(sec!="")dump(sec)}' > "$o"
